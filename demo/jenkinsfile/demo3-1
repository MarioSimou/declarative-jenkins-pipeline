pipeline {
    agent any
    environment {
        RELEASE="20.04"
    }
    parameters {
        string(name: "ENVIRONMENT", defaultValue: "PRODUCTION", description: "Environment to deploy")
    }

    stages {
        stage("Build"){
            parallel {
                stage("linux"){
                    steps {
                        echo "Building for $STAGE_NAME"
                    }
                }
                stage("macos"){
                    steps {
                        echo "Building for $STAGE_NAME"
                    }
                }
                stage("show key"){
                    steps {
                        withCredentials([
                            string(credentialsId: "slack5", variable: "SLACK_TOKEN")
                        ]){
                            echo "TOKEN: ${SLACK_TOKEN}"
                        }
                    }
                }
            }
        }
        stage("Testing"){
            steps {
                sh '''
                    echo "Running unit tests"
                '''
            }
        }
        stage("Deploying"){
            steps{
                echo "Deploying to ${params.ENVIRONMENT}"
                writeFile file: "test.txt", text: "hello world"
            }
        }
    }
    post {
        success {
            archiveArtifacts "test.txt"
            slackSend color: "good", message: "Message from Jenkins pipeline"
        }
    }
}